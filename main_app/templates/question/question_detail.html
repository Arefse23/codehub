{% extends 'base.html' %} 
{% block content %}

<nav id="sub-nav">
  <ul class="blue-text">
      <li> 
        <a class="btn grey darken-4" href="{% url 'category_detail' question.category.id %}">
          <i class="material-icons left">{{ question.category.icon_code }}</i>
          {{ question.category.name }} Questions
        </a>
      </i>
  </ul>
</nav>


<!--==================================Question Detail Section===============================-->
<h1>Question Details</h1>

<div class="card">
    <div class="card-content ">
      <div class="flex-container">
        <div>
          <span class="card-title">Title: {{ question.title }}</span>
          <p>Body: {{ question.body|safe}}</p>
          <p>Date: {{ question.date }}</p>
          {% load static %}
          <div class="profile-container profile-header comment">
            <img src="{% if question.user.profile.avatar %}
            {% static question.user.profile.avatar|cut:'main_app/static/' %}
            {% else %}{% static 'images/profile/guest.png' %}{% endif %}" 
            style="vertical-align: middle;">
            <span>{{ question.user.username }}</span>
          </div>
        </div>
      </div>
    </div>
  

  <!--Question Card Section-->
  {% if user.is_authenticated %}
  {% if user.id is question.user.id %}
  <div class="card-action">
    <a class="btn blue" href="{% url 'update_question' question.id %}">Edit</a>
    <a class="btn blue" href="{% url 'question_delete' question.id %}">Delete</a>
  </div>
  {% endif %}
  {% endif %}
  </div>



  <!--==================================Answer Detail Section===============================-->
  <form action="{% url 'answer_create' question.id %}" method="post">
    {% csrf_token %}
    {{ answer_form.media }}
    {{ answer_form }}
    <button type="submit" class="btn green">Add Answer</button>
  </form>

  <hr>

  {% for answer in answers %}
  <div class="card">
    <div class="card-content ">
      <div class="flex-container">
        <div>
          <span class="card-title">Title: {{ answer.title }}</span>
          <p>Body: {{ answer.body|safe}}</p>
          <p>Date: {{ answer.date }}</p>
          {% load static %}
          <div class="profile-container profile-header comment">
            <img src="{% if answer.user.profile.avatar %}
            {% static answer.user.profile.avatar|cut:'main_app/static/' %}
            {% else %}{% static 'images/profile/guest.png' %}{% endif %}" 
            style="vertical-align: middle;">
            <span>{{ answer.user.username }}</span>
          </div>
          
        </div>
        <div><a class="btn blue" href="{% url 'answer_detail' answer.id %}">View Replies</a></div>
      </div>
    </div>
    <div class="card-action">

      <!--Answer Card Section-->
      {% if user.is_authenticated %}
      {% if user.id is answer.user.id %}
      <a class="btn blue" href="{% url 'answer_update' answer.id %}">Edit</a>
      <a class="btn blue" href="{% url 'answer_delete' answer.id %}">Delete</a>
      {% endif %}
      {% endif %}

      <!--Like Button-->
      <form action="{% url 'like_answer' answer.id %}" method="post" 
      style="display: inline-block;">
        {% csrf_token %}
        {% if user in answer.likes.all %}
        <button type="submit" class="btn white black-text">
          <i class="material-icons right blue-text">thumb_up</i>
          {{ answer.likes.count }}
        </button>
        {% else %}
        <button type="submit" class="btn white black-text">
          <i class="material-icons right">thumb_up</i>
          {{ answer.likes.count }}
        </button>
        {% endif %}
      </form>

      <!--Dislike Button-->
      <form action="{% url 'dislike_answer' answer.id %}" 
      method="post" style="display: inline-block;">
        {% csrf_token %}
        {% if user in answer.dislikes.all %}
        <button type="submit" class="btn white black-text">
          <i class="material-icons right blue-text">thumb_down</i>
          {{ answer.dislikes.count }}
        </button>
        {% else %}
        <button type="submit" class="btn white black-text">
          <i class="material-icons right">thumb_down</i>
          {{ answer.dislikes.count }}
        </button>
        {% endif %}
      </form>

    </div>
  </div>
{% endfor %}
{% endblock %}